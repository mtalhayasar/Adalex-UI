{% load a_ui_tags %}
<form class="a-form" id="{{ id }}" action="{{ action }}" method="{{ method|default:'POST' }}" novalidate>
  {% if method|default:'POST' == 'POST' %}
    {% csrf_token %}
  {% endif %}
  
  {% if title %}
    <h2 class="a-form__title">{{ title }}</h2>
  {% endif %}
  
  <div class="a-form__fields">
    {% for field in fields %}
      <div class="a-form__group{% if field.error %} a-form__group--error{% endif %}">
        {% include "components/label.html" with for_id=field.name text=field.label required=field.required help_text=field.help_text %}
        
        {% if field.type == 'text' or field.type == 'email' or field.type == 'password' or field.type == 'tel' or field.type == 'url' or field.type == 'number' %}
          {% include "components/text_input.html" with name=field.name id=field.name type=field.type placeholder=field.placeholder value=field.value required=field.required error=field.error %}
        
        {% elif field.type == 'textarea' %}
          {% include "components/textarea.html" with name=field.name id=field.name placeholder=field.placeholder value=field.value rows=field.rows required=field.required error=field.error %}
        
        {% elif field.type == 'select' %}
          {% include "components/select.html" with name=field.name id=field.name options=field.options selected=field.value placeholder=field.placeholder required=field.required error=field.error %}
        
        {% elif field.type == 'checkbox' %}
          {% include "components/checkbox.html" with name=field.name id=field.name label=field.help_text value="1" checked=field.value required=field.required %}
          {% if field.error %}
            <div id="{{ field.name }}-error" class="a-form__error" role="alert">
              <span class="a-form__error-icon" aria-hidden="true">⚠</span>
              {{ field.error }}
            </div>
          {% endif %}
        
        {% elif field.type == 'radio' %}
          <div class="a-form__radio-group" role="radiogroup" aria-labelledby="{{ field.name }}-label">
            {% for option in field.options %}
              {% if option.value|stringformat:"s" == field.value|stringformat:"s" %}
                {% if field.required and forloop.first %}
                  {% include "components/radio.html" with name=field.name id=field.name|add:"_"|add:forloop.counter value=option.value label=option.label checked=True required=True %}
                {% else %}
                  {% include "components/radio.html" with name=field.name id=field.name|add:"_"|add:forloop.counter value=option.value label=option.label checked=True required=False %}
                {% endif %}
              {% else %}
                {% if field.required and forloop.first %}
                  {% include "components/radio.html" with name=field.name id=field.name|add:"_"|add:forloop.counter value=option.value label=option.label checked=False required=True %}
                {% else %}
                  {% include "components/radio.html" with name=field.name id=field.name|add:"_"|add:forloop.counter value=option.value label=option.label checked=False required=False %}
                {% endif %}
              {% endif %}
            {% endfor %}
          </div>
          {% if field.error %}
            <div id="{{ field.name }}-error" class="a-form__error" role="alert">
              <span class="a-form__error-icon" aria-hidden="true">⚠</span>
              {{ field.error }}
            </div>
          {% endif %}
        
        {% elif field.type == 'date' %}
          {% include "components/datepicker.html" with name=field.name id=field.name value=field.value required=field.required error=field.error %}
        
        {% elif field.type == 'switch' %}
          {% include "components/switch.html" with name=field.name id=field.name label=field.help_text checked=field.value required=field.required %}
          {% if field.error %}
            <div id="{{ field.name }}-error" class="a-form__error" role="alert">
              <span class="a-form__error-icon" aria-hidden="true">⚠</span>
              {{ field.error }}
            </div>
          {% endif %}
        {% endif %}
      </div>
    {% endfor %}
  </div>
  
  <div class="a-form__actions">
    {% include "components/button.html" with type="submit" variant="primary" text=submit_text|default:"Submit" %}
    {% if cancel_url %}
      {% include "components/button.html" with href=cancel_url variant="secondary" text="Cancel" %}
    {% endif %}
  </div>
</form>
